<app-search-bar class="dark-theme">
  <form (submit)="submit()" ngNativeValidate>
    <md-input-container  class="id-field">
      <input mdInput placeholder="ID de compra"
             [(ngModel)]="request.id"
             name="id" type="number">
    </md-input-container>

    <md-input-container class="id-field">
      <input mdInput placeholder="ID de sucursal"
             [(ngModel)]="request.branch_id"
             name="branch_id" type="number">
    </md-input-container>

    <app-branch-search class="search-button"
                       (selected)="request.branch_id = $event.id"></app-branch-search>

    <md-input-container class="id-field">
      <input mdInput placeholder="ID de usuario"
             [(ngModel)]="request.user_id"
             name="user_id" type="number">
    </md-input-container>

    <app-user-search class="search-button"
                     (selected)="request.user_id = $event.id"></app-user-search>
    <md-input-container class="id-field">
      <input mdInput placeholder="ID de proveedor"
             [(ngModel)]="request.supplier_id"
             name="client_id" type="number">
    </md-input-container>

    <app-supplier-search class="search-button"
                         (selected)="request.supplier_id = $event.id"></app-supplier-search>
    <my-date-range-picker placeholder="Rango de fechas"
                          (dateRangeChanged)="onDateRangeChanged($event)"
                          [options]="rangeOptions" ></my-date-range-picker>

    <button md-raised-button color="primary" type="submit" >
      <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>
      Consultar
    </button>
    <button md-raised-button color="primary" type="button" (click)="downloadCSV()">
      <i class="fa fa-arrow-circle-down" aria-hidden="true"></i>
      CSV
    </button>
  </form>
</app-search-bar>
<app-main-content>
  <h2>Reporte de compra</h2>

  <ul *ngIf="buys.length">
    <li>Número de compras: {{buys.length}}</li>
    <li>Total de compras: {{totalCostBuy | myCurrency}}</li>
    <li>Total de productos: {{totalProducts}}</li>
  </ul>

  <table>
    <thead>
    <tr>
      <th>ID</th>
      <th>Fecha</th>
      <th>Sucursal</th>
      <th>Usuario</th>
      <th>Proveedor</th>
      <th>Total</th>
    </tr>
    </thead>
    <ng-template ngFor let-buy [ngForOf]="buys">
      <tr>
        <td>{{buy.id}}</td>
        <td>{{buy.created_at | date:'short'}}</td>
        <td>{{buy.branch.name}}</td>
        <td>{{buy.user.name}}</td>
        <td>{{buy.supplier.name}}</td>
        <td>{{buy.total}}</td>
      </tr>
      <tr>
        <td class="no-border"></td>
        <td class="no-border" colspan="5">
        <table>
          <thead>
          <tr>
            <th>ID de Producto</th>
            <th>Tipo de movmiento</th>
            <th>Descripción</th>
            <th>Cantidad</th>
            <th>Costo</th>
            <th>Subtotal</th>
          </tr>
          </thead>
          <tr *ngFor="let product of buy.products">
            <td>{{product.id}}</td>
            <td>{{product.pivot.inventory_movement_type.name}}</td>
            <td>{{product.description}}</td>
            <td>{{product.pivot.quantity}}</td>
            <td>{{product.pivot.cost | currency:'USD':true:'1.2-2'}}</td>
            <td>{{product.pivot.cost * product.pivot.quantity | currency:'USD':true:'1.2-2'}}</td>
          </tr>
        </table>
        </td>
      </tr>
    </ng-template>
  </table>
</app-main-content>
