<app-search-bar class="dark-theme">
  <form (submit)="submit()" ngNativeValidate>
    <md-input-container class="id-field">
      <input mdInput placeholder="ID de sucursal"
             [(ngModel)]="request.branch_id"
             name="branch_id" type="number">
    </md-input-container>

    <app-branch-search class="search-button"
                       (selected)="request.branch_id = $event.id"></app-branch-search>

    <md-input-container class="id-field">
      <input mdInput placeholder="ID de producto"
             [(ngModel)]="request.product_id"
             name="product_id" type="number">
    </md-input-container>

    <app-product-search class="search-button"
                        (selected)="request.product_id = $event.id"></app-product-search>

    <md-input-container class="id-field">
      <input mdInput placeholder="Cantidad"
             [(ngModel)]="request.quantity"
             name="quantity" type="number">
    </md-input-container>

    <md-input-container class="id-field">
      <input mdInput placeholder="Precio"
             [(ngModel)]="request.price"
             name="price" type="number">
    </md-input-container>

    <md-input-container class="id-field">
      <input mdInput placeholder="MÃ­nimo"
             [(ngModel)]="request.minimum"
             name="minimum" type="number">
    </md-input-container>

    <button md-raised-button color="primary" type="submit">
      <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>
      Consultar
    </button>
    <button md-raised-button color="primary" type="button" (click)="downloadCSV()">
      <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>
      CSV
    </button>
  </form>
</app-search-bar>
<app-main-content>
  <h2>Reporte de inventario</h2>
  <ul>
    <li *ngIf="inventories"> Registros de inventario: {{inventories.length}}</li>
    <li>Registros de inventario con existencias {{productsWithExistences}}</li>
    <li>Productos diferentes registrados: {{registeredProducts}}</li>
    <li>Valor al costo del inventario: {{costValue | myCurrency}}</li>
    <li>Valor al precio del inventario: {{priceValue | myCurrency}}</li>
  </ul>


  <div class="example-container mat-elevation-z8">

    <md-paginator #paginator
                  [length]="exampleDatabase.data.length"
                  [pageIndex]="0"
                  [pageSize]="25"
                  [pageSizeOptions]="[5, 10, 25, 100]">
    </md-paginator>
    <md-table #table [dataSource]="dataSource">

      <ng-container mdColumnDef="branch">
        <md-header-cell *mdHeaderCellDef> Sucursal </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.branch.name}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="id">
        <md-header-cell *mdHeaderCellDef> ID </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.id}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="product">
        <md-header-cell *mdHeaderCellDef> Producto </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.product.description}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="categories">
        <md-header-cell *mdHeaderCellDef> Categorias </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.product.toStringCategories()}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="brand">
        <md-header-cell *mdHeaderCellDef> Marca </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.product.brand ? row.product.brand.name : ''}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="quantity">
        <md-header-cell *mdHeaderCellDef> Cantidad </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.quantity}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="price">
        <md-header-cell *mdHeaderCellDef> Precio </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.current_price | myCurrency}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="total_price">
        <md-header-cell *mdHeaderCellDef> Precio Subtotal </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.subtotalPrice | myCurrency}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="cost">
        <md-header-cell *mdHeaderCellDef> Costo </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.current_total_cost | myCurrency}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="margin">
        <md-header-cell *mdHeaderCellDef> Margen </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.margin | percent}} </md-cell>
      </ng-container>

      <ng-container mdColumnDef="minimum">
        <md-header-cell *mdHeaderCellDef> Minimo </md-header-cell>
        <md-cell *mdCellDef="let row"> {{row.minimum}} </md-cell>
      </ng-container>


      <md-header-row *mdHeaderRowDef="displayedColumns"></md-header-row>
      <md-row *mdRowDef="let row; columns: displayedColumns;"></md-row>
    </md-table>

    <md-paginator #paginator
                  [length]="exampleDatabase.data.length"
                  [pageIndex]="0"
                  [pageSize]="25"
                  [pageSizeOptions]="[5, 10, 25, 100]">
    </md-paginator>
  </div>
</app-main-content>
